{% extends 'main/base.html' %}
{% block title %}{% endblock %}
{% block specific_script %}
<style>
  [class*="btn"] {
    border-radius: 20px;
  }

  [class*="sidebar-btn"] {
    border-radius: 50%;
    width: 33px;
    padding: 7px 7px 7px 7px;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .shop_logo {
    padding: 20px 20px 20px 20px;
    border-radius: 50%;
    /* border:2px solid blue;  */
  }

  .card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 310px;
    padding-top: 5px;
    padding-bottom:15px;
    border-radius: 8px;
    border: 0.5px solid rgb(190, 196, 201);
    box-shadow: 0 0 6px gray;
  }

  .card:hover {
    box-shadow: 0 0 6px rgb(22, 24, 170);
  }

  /* .card:hover img{
  transform: scale(0.5);
} */

  .card-item {
    flex: 1;
    /* border:2px solid black;  */
  }

  .group {
    display: flex;
    align-items: baseline;
  }

  .card-item img {
    width: 300px;
    height: 160px;
    border-radius: 8px;
    transition: transform 0.5s;
    object-fit: cover;
    transform: scale(1.02, 1.1)
  }

  #inner {
    /* border:2px solid indigo;  */
    overflow: hidden;
    border-radius: 8px;
    padding-top: 0px;
    box-shadow: 0 0 8px gray;
  }

  .card-item img:hover {

    transform: scale(1.05, 1.15);

  }


  #card-img {
    margin-top: 5px;
    padding: 0 10px 0 10px;
  }


  @media(min-width:321px) and (max-width:575.5px) {
    .card {
      flex-basis: 65%;
    }

    #column {
      display: flex;
      justify-content: center;
    }
  }

  @media(min-width:721px) and (max-width:990.5px) {
    .card {
      width: 72%;
    }

    #card-center {
      display: flex;
      justify-content: center;
      /* border:2px solid blue;  */
    }

    #column {
      display: flex;
      justify-content: center;
      /* border: 2px solid red; */
    }

    #card-center:last-child {
      justify-content: flex-start;
    }


  }

  #message {
    margin-top: 5px;
    font-style: italic;
    text-align: center;
  }
</style>
{% endblock %}
{% load static %}

{% block content %}
<div class="modal fade" id="general_modal" tabindex="-1" aria-labelledby="" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <p class="text-muted" style="font-style:italic;text-align: center;"> Are you sure you want to delete this
          product? This action cannot be undone. Please be certain.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-success" data-bs-dismiss="modal">Cancel</button>
        <a href="" id="modal_link" class="btn btn-danger">Confirm</a>
      </div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <h1 class="h2 border-bottom pt-1 pb-3">
      <span class="shop_logo"><i class="fa fa-tag text-primary"></i></span><span>{{cart.store.name}} - CART</span>
    </h1>
  </div>
</div>

<div class="big-container">

 
  <div id="main-container">
    <div class="container-fluid">
      <div class="row">
        <div class="col">
          <form action="" class="d-flex" method="GET">
            {% csrf_token %}
            <input name="q" class="form-control me-1" type="search" placeholder="Search cart..."
              aria-label="Search">
            <button class="btn btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>


      <div class="row">
        <div class="col">
          {% if messages %}
          {%for message in messages%}
          <h5 class="text-muted" id="message">{{message}}</h5>
          {% endfor %}
          {% endif %}
        </div>
      </div>
     
      <!-- this side needs some renovation   -->
      <div class="row mt-3" id="card-center">
        {% for product in products %}
        <div class="col-lg-3 col-sm-6 col-12 mb-3" id="column">
          <div class="card">
            <div class="card-item" id="card-img">

              <div id="inner">
                <a href=""><img src="{{ product.product.image.url }}" class="img-fluid mt-2"
                    alt="{{ product.image.url }}" /></a>
              </div>
            </div>

            <div class="card-item">
              <div class="group"><span class="fa fa-tag p-2"></span>
                <h5 class="card-title">GHS {{product.product.price}}</h5>
              </div>
            </div>
            <div class="card-item">
              <p class="card-text">{{product.product.name}} ({{product.quantity}})</p>
            </div>

            <div class="card-item">
              <a href="{% url 'remove_from_cart' product.product.store.owner product.product.store.name product.product.id %}" class="btn btn-outline-primary btn-sm mb-1"><i
                  class="fa fa-trash"></i> Remove from cart</a>
            </div>
            <div class="card-item">
              <a href="{% url 'place_order' shop.owner shop.name  %}?products={{product}}" class="btn btn-outline-primary btn-sm"><i class="fa fa-box"></i> Order</a>
            </div>
            
            
            <div class="row" style="flex-direction: row;">
              {% if product.stock is not None %}<p>Available in stock: {{product.product.stock}}</p>{% endif %}
              <!-- <div class="counter-plus btn btn-success col-2" onclick="add_counter(this)">+</div>
              <div style="font-weight: bold;" class="counter-display btn btn-outline-dark col-6">1</div>
              <div class="counter-minus btn btn-danger col-2" onclick="minus_counter(this)">-</div> -->
              <a href="{% url 'add_to_cart' product.product.store.owner.username product.product.store.name product.product.id %}" class="btn btn-success col-2">+</a>
              <div style="font-weight: bold;" class="counter-display btn btn-outline-dark col-6">{{product.quantity}}</div>
              <a href="{% url 'remove_from_cart' product.product.store.owner product.product.store.name product.product.id %}" class="counter-minus btn btn-danger col-2">-</a>
              <div class="btn btn-danger" style="display: none;">That is the maximum stock!</div>
              <div class="stock" style="display: none;">{{product.product.stock}}</div>
            </div>
            

          </div>
        </div>

        {% endfor %}

        <h3><a href="{% url 'place_order' shop.owner shop.name %}?products=*cart">Order All Cart Items</a></h3>
      </div>
    </div>
  </div>
</div>
<!-- SIDE NAV SECTION -->
<nav id="test_div">
  <div class="side-icon-container">
    <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'shop' shop.owner.username shop.name %}"><i class="fa fa-store"></i></a>
        <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'my_shops' request.user.username %}"><i class="fa fa-shop"></i></a>
        <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'all_shops' %}"><i
        class="fa fa-search"></i></a>

        </div>
  
</nav>

<!-- BOTTOM NAV SECTION -->
<nav class="bottom-nav">
  <div class="bottom-nav-icons">
    <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'shop' shop.owner.username shop.name %}"><i class="fa fa-store"></i></a>
    <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'my_shops' request.user.username %}"><i class="fa fa-shop"></i></a>
    <a class="btn btn-outline-primary sidebar-btn mb-2" href="{% url 'all_shops' %}"><i
    class="fa fa-search"></i></a>


  </div>
</nav>


<script>
  let modal_link = document.getElementById('modal_link');


  function change_href(id) {
    modal_link.setAttribute('href', `/delete_product/${id}`);
  }

  function add_counter(element) {
    let init = +element.nextElementSibling.innerText;
    let stock_element = element.parentElement.lastElementChild;
    let stock = element.parentElement.lastElementChild.innerText;
    if (stock != 'None') {

      if (init < +stock) {
        stock_element.previousElementSibling.style.display = 'none';
        element.nextElementSibling.innerText = init + 1
      } else {
        stock_element.previousElementSibling.style.display = 'block';
        console.log(stock_element);
      }

    }
    else { element.nextElementSibling.innerText = init + 1 }
  }

  function minus_counter(element) {
    let stock_element = element.parentElement.lastElementChild;
    let init = +element.previousElementSibling.innerText;
    if (init > 1) {
      stock_element.previousElementSibling.style.display = 'none';
      element.previousElementSibling.innerText = init - 1;
    }
  }

</script>
{% endblock %}